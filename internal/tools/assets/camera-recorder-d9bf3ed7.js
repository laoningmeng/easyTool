import{o as e,j as s,q as o,e as E,z as y,ap as se,d as re,aq as ae,ar as ce,T as le,n as t,E as p,w as a,F as de,r as ue,y as _e,v as Z,m as v,k as l,B as D,ad as R,s as me,x as pe}from"./index-a828413e.js";import{_ as ve}from"./c-select-7c7834cf.js";import{_ as he}from"./c-alert-8d5f3d99.js";const fe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ge=o("path",{fill:"currentColor",d:"M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12M8 9h8v10H8V9m7.5-5l-1-1h-5l-1 1H5v2h14V4h-3.5Z"},null,-1),ke=[ge];function we(m,i){return e(),s("svg",fe,ke)}const ye={name:"mdi-delete-outline",render:we},$e={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},be=o("path",{fill:"currentColor",d:"M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7l7-7Z"},null,-1),xe=[be];function Ce(m,i){return e(),s("svg",$e,xe)}const Re={name:"mdi-download",render:Ce},Me={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Se=o("path",{fill:"currentColor",d:"M19 12c0 3.86-3.14 7-7 7s-7-3.14-7-7s3.14-7 7-7s7 3.14 7 7Z"},null,-1),Ve=[Se];function Be(m,i){return e(),s("svg",Me,Ve)}const He={name:"mdi-record",render:Be},Ie={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},je=o("path",{fill:"currentColor",d:"M8 5.14v14l11-7l-11-7Z"},null,-1),Ae=[je];function Ue(m,i){return e(),s("svg",Ie,Ae)}const Ze={name:"mdi-play",render:Ue},De={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ee=o("path",{fill:"currentColor",d:"M14 19h4V5h-4M6 19h4V5H6v14Z"},null,-1),Ne=[Ee];function Te(m,i){return e(),s("svg",De,Ne)}const qe={name:"mdi-pause",render:Te},Le={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Pe=o("path",{fill:"currentColor",d:"M17 10.5V7a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-3.5l4 4v-11l-4 4Z"},null,-1),Ye=[Pe];function ze(m,i){return e(),s("svg",Le,Ye)}const Fe={name:"mdi-video",render:ze},Ge={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Oe=o("path",{fill:"currentColor",d:"M4 4h3l2-2h6l2 2h3a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2m8 3a5 5 0 0 0-5 5a5 5 0 0 0 5 5a5 5 0 0 0 5-5a5 5 0 0 0-5-5m0 2a3 3 0 0 1 3 3a3 3 0 0 1-3 3a3 3 0 0 1-3-3a3 3 0 0 1 3-3Z"},null,-1),We=[Oe];function Je(m,i){return e(),s("svg",Ge,We)}const Ke={name:"mdi-camera",render:Je};function Qe({stream:m}){const i=E(()=>MediaRecorder.isTypeSupported("video/webm")),n=y(null),x=y([]),M=se(),d=y("stopped"),h=()=>{const w=new Blob(x.value,{type:"video/webm"}),B=URL.createObjectURL(w);return x.value=[],B};return{isRecordingSupported:i,startRecording:()=>{i.value&&m.value&&d.value==="stopped"&&(n.value=new MediaRecorder(m.value,{mimeType:"video/webm"}),n.value.ondataavailable=w=>{w.data.size>0&&x.value.push(w.data)},n.value.onstop=()=>{M.trigger(h())},n.value.state==="inactive"&&(n.value.start(),d.value="recording"))},stopRecording:()=>{i.value&&n.value&&d.value!=="stopped"&&(n.value.stop(),d.value="stopped")},pauseRecording:()=>{i.value&&n.value&&d.value==="recording"&&(n.value.pause(),d.value="paused")},resumeRecording:()=>{i.value&&n.value&&d.value==="paused"&&(n.value.resume(),d.value="recording")},recordingState:d,onRecordAvailable:M.on}}const Xe={key:1,"mt-4":"",flex:"","justify-center":""},et={flex:"","flex-col":"","gap-2":""},tt={key:0,"mt-3":"",flex:"","justify-center":""},ot={key:1},nt={"my-2":""},it={flex:"","items-center":"","justify-between":"","gap-2":""},st={"mr-2":""},rt={key:0,flex:"","justify-center":"","gap-2":""},at={"mr-2":""},ct={"mr-2":""},lt={"mr-2":""},dt={"mr-2":""},ut={key:1,italic:"","op-60":""},_t={grid:"","grid-cols-2":"","mt-5":"","gap-2":""},mt=["src"],pt=["src"],vt={flex:"","items-center":"","justify-between":""},ht={"font-bold":""},ft={flex:"","gap-2":""},$t=re({__name:"camera-recorder",setup(m){var I,j;const{videoInputs:i,audioInputs:n,permissionGranted:x,isSupported:M,ensurePermissions:d}=ae({requestPermissions:!0,constraints:{video:!0,audio:!0},onUpdated(){z()}}),h=y(),b=y([]),k=y((I=i.value[0])==null?void 0:I.deviceId),f=y((j=n.value[0])==null?void 0:j.deviceId),V=y(!1),{stream:w,start:B,enabled:H}=ce({constraints:E(()=>({video:{deviceId:k.value},...f.value?{audio:{deviceId:f.value}}:{}})),autoSwitch:!0}),{isRecordingSupported:N,onRecordAvailable:T,startRecording:q,stopRecording:L,pauseRecording:P,recordingState:S,resumeRecording:Y}=Qe({stream:w});T(r=>{b.value.unshift({type:"video",value:r,createdAt:new Date})});function z(){var r,u;(Z.isNil(k)||!i.value.find(c=>c.deviceId===k.value))&&(k.value=(r=i.value[0])==null?void 0:r.deviceId),(Z.isNil(n)||!n.value.find(c=>c.deviceId===f.value))&&(f.value=(u=n.value[0])==null?void 0:u.deviceId)}function F(){var c;if(!h.value)return;const r=document.createElement("canvas");r.width=h.value.videoWidth,r.height=h.value.videoHeight,(c=r.getContext("2d"))==null||c.drawImage(h.value,0,0);const u=r.toDataURL("image/png");b.value.unshift({type:"image",value:u,createdAt:new Date})}le(()=>{h.value&&w.value&&(h.value.srcObject=w.value)});async function G(){try{await d()}catch{V.value=!0}}function O({type:r,value:u,createdAt:c}){const C=document.createElement("a");C.href=u,C.download=`${r}-${c.getTime()}.${r==="image"?"png":"webm"}`,C.click()}return(r,u)=>{const c=_e,C=he,g=pe,A=ve,W=Ke,J=Fe,K=qe,Q=Ze,X=He,ee=Re,te=ye;return e(),s("div",null,[t(M)?t(x)?(e(),p(c,{key:2},{default:a(()=>[o("div",et,[l(A,{value:t(k),"onUpdate:value":u[0]||(u[0]=_=>D(k)?k.value=_:null),"label-position":"left","label-width":"60px",label:"Video:",options:t(i).map(({deviceId:_,label:$})=>({value:_,label:$})),placeholder:"Select camera"},null,8,["value","options"]),t(f)&&t(n).length>0?(e(),p(A,{key:0,value:t(f),"onUpdate:value":u[1]||(u[1]=_=>D(f)?f.value=_:null),label:"Audio:","label-position":"left","label-width":"60px",options:t(n).map(({deviceId:_,label:$})=>({value:_,label:$})),placeholder:"Select microphone"},null,8,["value","options"])):R("",!0)]),t(H)?(e(),s("div",ot,[o("div",nt,[o("video",{ref_key:"video",ref:h,autoplay:"",controls:"",playsinline:"","max-h-full":"","w-full":""},null,512)]),o("div",it,[l(g,{disabled:!t(H),onClick:F},{default:a(()=>[o("span",st,[l(W)]),v(" Take screenshot ")]),_:1},8,["disabled"]),t(N)?(e(),s("div",rt,[t(S)==="stopped"?(e(),p(g,{key:0,onClick:t(q)},{default:a(()=>[o("span",at,[l(J)]),v(" Start recording ")]),_:1},8,["onClick"])):R("",!0),t(S)==="recording"?(e(),p(g,{key:1,onClick:t(P)},{default:a(()=>[o("span",ct,[l(K)]),v(" Pause ")]),_:1},8,["onClick"])):R("",!0),t(S)==="paused"?(e(),p(g,{key:2,onClick:t(Y)},{default:a(()=>[o("span",lt,[l(Q)]),v(" Resume ")]),_:1},8,["onClick"])):R("",!0),t(S)!=="stopped"?(e(),p(g,{key:3,type:"error",onClick:t(L)},{default:a(()=>[o("span",dt,[l(X)]),v(" Stop ")]),_:1},8,["onClick"])):R("",!0)])):(e(),s("div",ut," Video recording is not supported in your browser "))])])):(e(),s("div",tt,[l(g,{type:"primary",onClick:t(B)},{default:a(()=>[v(" Start webcam ")]),_:1},8,["onClick"])]))]),_:1})):(e(),p(c,{key:1,"text-center":""},{default:a(()=>[v(" You need to grant permission to use your camera and microphone "),t(V)?(e(),p(C,{key:0,"mt-4":"","text-left":""},{default:a(()=>[v(" Your browser has blocked permission request or does not support it. You need to grant permission manually in your browser settings (usually the lock icon in the address bar). ")]),_:1})):(e(),s("div",Xe,[l(g,{onClick:G},{default:a(()=>[v(" Grant permission ")]),_:1})]))]),_:1})):(e(),p(c,{key:0},{default:a(()=>[v(" Your browser does not support recording video from camera ")]),_:1})),o("div",_t,[(e(!0),s(de,null,ue(t(b),({type:_,value:$,createdAt:oe},U)=>(e(),p(c,{key:U},{default:a(()=>[_==="image"?(e(),s("img",{key:0,src:$,"max-h-full":"","w-full":"",alt:"screenshot"},null,8,mt)):(e(),s("video",{key:1,src:$,controls:"","max-h-full":"","w-full":""},null,8,pt)),o("div",vt,[o("div",ht,me(_==="image"?"Screenshot":"Video"),1),o("div",ft,[l(g,{onClick:ne=>O({type:_,value:$,createdAt:oe})},{default:a(()=>[l(ee)]),_:2},1032,["onClick"]),l(g,{onClick:ne=>b.value=t(b).filter((gt,ie)=>ie!==U)},{default:a(()=>[l(te)]),_:2},1032,["onClick"])])])]),_:2},1024))),128))])])}}});export{$t as default};
